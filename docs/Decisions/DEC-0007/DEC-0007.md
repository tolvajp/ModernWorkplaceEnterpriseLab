# Decision Log – Group taxonomy and naming rules

---

## Decision ID
- **ID:** DEC-0007
- **Status:** Accepted
- **Date:** 2025-12-28
- **Owner:** Peter Tolvaj

---

## Decision Domain

This decision domain defines the **tenant-wide group naming and baseline metadata rules** used across the lab.

It is intentionally limited to **taxonomy and naming mechanics**:
- how a group name is formed and normalized,
- what baseline metadata is set (`mailNickname`, `description`),
- and how configuration drift is avoided.

This decision does not define which functional group categories exist (licensing, roles, departments, etc.).
Those are decided in their own decision domains.

The group naming conventions defined in this decision are intentionally designed to be **modular and future-proof**.

The naming structure must allow the introduction of new group types and functions in later decision domains
without requiring renaming or refactoring of existing groups.

---

## Scope

### In Scope
- Group name structure and normalization rules
- Allowed and disallowed characters in group names
- Baseline metadata rules (`mailNickname`, `description`)
- Drift prevention via automation
- Modularity requirements for the group creation logic

### Out of Scope
- Functional group categories (LIC, ROLE, DEP, CTX, etc.)
- Group purpose and enforcement behaviour
- Membership rules (assigned vs dynamic)
- User vs device scoping decisions beyond the naming token

---

## Atomic Decisions

1. All managed group names follow a tokenized, extensible structure
2. Allowed characters are explicitly defined
3. Whitespace and disallowed characters are removed
4. `mailNickname` equals the normalized group name. It should not be longer than 64 char.
5. Group descriptions are mandatory and explicit
6. Managed groups are created exclusively by automation
7. Group creation logic must be modular and extensible

---

### Atomic Decision 1 – Tokenized and extensible group name structure

**Decision**  
All managed group names follow the structure:

`<Principal>-<Function>-<Specifier>-<Specifier>-...`

Where:
- `Principal` is exactly one of:
  - `U` – user principals
  - `D` – device principals
  - `X` – mixed principals (exceptional use only)
- `Function` expresses the high-level intent of the group
- One or more `Specifier` tokens qualify the function

At least one `Specifier` token is mandatory.

**Scope**  
Applies to all managed groups created and maintained by lab automation.

**Rationale**  
A tokenized structure enables deterministic automation and human readability.
Allowing multiple specifiers avoids artificial depth limits and supports future extensions
(e.g. SKU, tier, scope, platform) without redesign.

**Alternatives considered**
- Fixed-depth naming (`<Principal>-<Function>-<Subfunction>`) – rejected (not extensible)
- Free-form naming – rejected (automation ambiguity)

---

### Atomic Decision 2 – Explicit allowed characters

**Decision**  
Only the following characters are allowed in group names:

- A–Z  
- a–z  
- 0–9  
- `-`  
- `_`

Any other character is invalid.

**Scope**  
Applies to `displayName` and therefore to `mailNickname`.

**Rationale**  
Restricting the character set eliminates encoding, escaping, and parsing edge cases
in automation and Graph queries.

**Alternatives considered**
- Allow spaces and punctuation – rejected (complexity and drift risk)

---

### Atomic Decision 3 – Removal of whitespace and invalid characters

**Decision**  
Whitespace and any character outside the allowed set (A–Z a–z 0–9 - _) are automatically removed
during group name generation.

**Scope**  
Applies to all input tokens used to construct group names.

**Rationale**  
Automatic normalization ensures deterministic output and prevents failures caused by
human input variance.

**Alternatives considered**
- Reject invalid input – rejected (unnecessary friction for a lab)
- Replace invalid characters with separators – rejected (risk of ambiguity)

---

### Atomic Decision 4 – `mailNickname` equals group name

**Decision**  
The `mailNickname` property is set to exactly the same value as the normalized group name.
It should not be longer than 64 character

**Scope**  
Applies to all managed groups.

**Rationale**  
Avoids parallel naming schemes and guarantees deterministic identity metadata.
64 characters is the limit for mailnickname property.

---

### Atomic Decision 5 – Mandatory explicit description

**Decision**  
Every managed group must have a non-empty, human-readable description that clearly states
the group’s intended purpose.

**Scope**  
Applies to all managed groups.

**Rationale**  
Descriptions provide the human-facing context and prevent misinterpretation
as the number of groups grows.

**Alternatives considered**
- Optional descriptions – rejected (reduced clarity and auditability)

---

### Atomic Decision 6 – Drift prevention through automation

**Decision**  
All managed groups are created exclusively by automation scripts.
Manual creation of managed groups is not permitted.

**Scope**  
Applies to all groups governed by this naming model.

**Rationale**  
Automation ensures repeatability, prevents configuration drift,
and enables reliable validation.

**Alternatives considered**
- Mixed manual and automated creation – rejected (inevitable drift)

---

### Atomic Decision 7 – Modular and extensible creation logic

**Decision**  
The group creation logic must be modular so that new group functions or rules
can be added with minimal refactoring existing behaviour.

**Scope**  
Applies to the design of the automation, not individual group definitions.

**Rationale**  
The lab will evolve; extensibility ensures future decisions remain additive.

---

## Cross-Cutting Rules / Invariants

- Naming and normalization rules are enforced centrally by automation
- `displayName` and `mailNickname` always match
- Descriptions are mandatory
- Extensibility is achieved by adding tokens, not renaming groups

---

## Validation

- [x] Group creation script exists for this decision domain (implementation present)
- [x] Script enforces the naming decisions:
  - [x] Names match: `<Principal>-<Function>-<Qualifier>-...`
  - [x] Only allowed characters remain: `A–Z a–z 0–9 - _`
  - [x] Whitespace is removed
  - [x] `mailNickname` equals `displayName`
  - [x] Description is always set and non-empty
- [x] (When tests exist) unit tests cover normalization and name generation rules

---

## Rollback / Exit Strategy

- Disable or remove the group creation automation
- No partial enforcement remains, as this domain defines naming and metadata only

---

## Notes

This decision defines **how groups are named**, not **what they do**.
