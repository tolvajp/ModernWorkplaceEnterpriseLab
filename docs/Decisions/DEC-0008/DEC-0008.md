# Decision Log – License Distribution Model

---

## Decision ID
- **ID:** DEC-0008
- **Status:** Accepted
- **Date:** 2025-12-29
- **Owner:** Peter Tolvaj

---

## Decision Domain

This decision defines the **license distribution model** used in the Modern Workplace Enterprise Lab.

The focus of this decision is **how licenses are expressed, structured, and automated**, not commercial optimization.
The model is intentionally enterprise-oriented while remaining scoped and simplified for lab usage.

This file contains multiple **atomic decisions** that together define the chosen approach for license distribution.

---

## Related Decisions

- Identity and account model decisions (admin vs user accounts)
- Group-based intent model decisions
- Prior decision establishing **Microsoft 365 E5 as the only license used in this lab**

---

## Atomic Decisions

### Atomic Decision 1 – License assignment model

**Decision**  
All license assignments are performed **exclusively via group-based licensing**.  
Direct user license assignment is not permitted.

**Context**  
Group-based licensing provides deterministic behavior, auditability, and automation friendliness.
Group membership expresses **intent**, while license assignment is a derived outcome.

---

### Atomic Decision 2 – Group type and membership model

**Decision**  
License groups are implemented as **Security groups** with **static membership**.

**Context**  
Static security groups make license intent explicit and predictable.
Dynamic membership rules are intentionally avoided to prevent hidden logic and debugging complexity.

---

### Atomic Decision 3 – License assignment unit

**Decision**  
Each license group represents **one license intent**.

**Context**  
This keeps the model simple, extensible, and aligned with enterprise practices.
Even though only one SKU is implemented in the lab, the structure supports future expansion.

---

### Atomic Decision 4 – Lab license scope (E5-only)

**Decision**  
This lab uses **Microsoft 365 E5 as the only implemented license SKU**.

**Context**  
This decision was made in a prior decision domain.
The purpose of this decision is to define the **distribution logic**, not SKU variety.

The licensing model is designed generically, but only **E5 is instantiated** in this lab as describedd in DEC-0002

---

### Atomic Decision 5 – Add-on license handling

**Decision**  
Add-on licenses are treated identically to baseline licenses and are modeled as standard license groups (`LIC`).

**Context**  
The lab does not differentiate add-on lifecycle or ownership.
This keeps the model minimal while preserving conceptual correctness.

**Enterprise disclaimer**  
In real environments, add-on licenses often have independent lifecycle, ownership, and approval flows.

---

### Atomic Decision 6 – Persona and license relationship

**Decision**  
Personas do not receive licenses directly.  
Licenses are always derived from **group membership**.

**Context**  
Personas are a conceptual abstraction.
Enforcement and automation always operate on groups.

---

### Atomic Decision 7 – Admin account licensing

**Decision**  
Administrative accounts are **not licensed by default**.

If licensing becomes strictly necessary, **Microsoft 365 E5** is used.

**Context (lab)**  
Admin accounts are not productivity identities.
Reducing licensed admin identities lowers attack surface and simplifies the model.

**Enterprise disclaimer**  
In real environments, some admin roles may require specific licenses depending on workload and tooling.
Such cases are evaluated per role and environment.

---

### Atomic Decision 8 – License conflict handling

**Decision**  
No license conflict resolution logic is implemented in this lab.

**Context**  
Only one license SKU (E5) exists, making conflicts impossible.
The conflict-resolution concept is intentionally documented but not implemented.

---

### Atomic Decision 9 – License group naming convention

**Decision**  
All license groups follow the naming convention:

```
U-LICENSE-<SKU>
```
Examle: U-LICENSE-SPE_E5

**Context**  
- `U` indicates user-scoped intent  
- `LICENSE` indicates license assignment  
- <SKU> explicitly identifies the SKU. FE: SPE_E5  

Group descriptions must include:
- License SKU

---

### Atomic Decision 10 – Ownership model

**Decision**  
License groups use **default tenant ownership** in this lab.

**Context (lab)**  
Ownership modeling is not a focus area at this stage of the lab.

**Enterprise disclaimer**  
In production environments, license groups typically have dedicated ownership,
often combined with PIM and approval workflows.

---

### Atomic Decision 11 – Automation and testing

**Decision**  
License group creation and validation are automated using **Graph PowerShell**.

The test suite `New-MWEGroup.tests.ps1` must be updated to represent the decisions made in this document.

**Context**  
Automation ensures reproducibility and consistency.
Tests act as documentation and regression protection.

---

### Atomic Decision 12 – Idempotency and drift handling

**Decision**  
Group membership is the **single source of truth**.

**Context**  
All automation must be idempotent.
Any manual changes are treated as drift and reconciled by scripts.

---

### Atomic Decision 13 – Rationale for group-based licensing

**Decision**  
Group-based licensing is chosen partly for **operational transparency**.

**Context**  
Groups enable answering:
- Who has a license?
- Why do they have it?
- Where is this defined?

This is an explicit design goal.

---

### Atomic Decision 14 – Validation strategy

**Decision**  
Current validation is limited to:
- Group existence
- Naming convention correctness

**Context**  
User-level validation is deferred until user provisioning is implemented.
Scripted tests for license mismatch are out of scope for this lab.

---

## Cross-Cutting Rules / Invariants

- No direct user license assignment
- Group membership expresses intent
- License assignment is always derived
- Only Microsoft 365 E5 is implemented
- Automation must be idempotent

---

## Validation

Validation is performed via:
- Script execution results
- Manual review of created groups

User-level license validation will be introduced in a later decision domain.

---

## Rollback / Exit Strategy

Rollback consists of:
- Deleting license groups
- Disabling group-based licensing if required

No user-level cleanup is necessary, as no direct assignments exist.

---

## Notes

This decision intentionally prioritizes **model correctness and clarity** over feature completeness.
The structure is designed to scale beyond the lab without requiring conceptual redesign.
